////////////////////////////////////////////////////////////////// WL_MENU.C by John Romero (C) 1992 Id Software, Inc.////////////////////////////////////////////////////////////////// PRIVATE PROTOTYPES ENDSTRx constants are defined in foreign.h CP_iteminfo struct format: short x, y, amount, curpos, indent;////////////////////////////////////////////////////////////////// INPUT MANAGER SCANCODE TABLES////////////////////////////////////////////////////////////////// Scan code names with single chars DEBUG - consolidate these Scan codes with >1 char names Names corresponding to ExtScanCodes#pragma warning 737 9
static byte
                                        *ScanNames[] =          // Scan code names with single chars
                                        {
        "?","?","1","2","3","4","5","6","7","8","9","0","-","+","?","?",
        "Q","W","E","R","T","Y","U","I","O","P","[","]","|","?","A","S",
        "D","F","G","H","J","K","L",";","\"","?","?","?","Z","X","C","V",
        "B","N","M",",",".","/","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","\xf","?","-","\x15","5","\x11","+","?",
        "\x13","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"
                                        };      // DEBUG - consolidate these
static byte ExtScanCodes[] =    // Scan codes with >1 char names
                                        {
        1,0xe,0xf,0x1d,0x2a,0x39,0x3a,0x3b,0x3c,0x3d,0x3e,
        0x3f,0x40,0x41,0x42,0x43,0x44,0x57,0x59,0x46,0x1c,0x36,
        0x37,0x38,0x47,0x49,0x4f,0x51,0x52,0x53,0x45,0x48,
        0x50,0x4b,0x4d,0x00
                                        };
static byte *ExtScanNames[] =   // Names corresponding to ExtScanCodes
                                        {
        "Esc","BkSp","Tab","Ctrl","LShft","Space","CapsLk","F1","F2","F3","F4",
        "F5","F6","F7","F8","F9","F10","F11","F12","ScrlLk","Enter","RShft",
        "PrtSc","Alt","Home","PgUp","End","PgDn","Ins","Del","NumLk","Up",
        "Down","Left","Right",""
                                        };   0   8  16  24  32  40  48  56  64  72  80  88  96 104 112 120 128 136 144 152 160 168 176 184 192 200 208 216 224 232 240 248 256 264 272 280 288 296 304 312 320////////////////////////////////////////////////////////////////// Wolfenstein Control Panel!  Ta Da!////////////////////////////////////////////////////////////////// F-KEYS FROM WITHIN GAME MAIN MENU LOOP EASTER EGG FOR SPEAR OF DESTINY! "EXIT OPTIONS" OR "NEW GAME" EXITS DEALLOCATE EVERYTHING CHANGE MAINMENU ITEM RETURN/START GAME EXECUTION////////////////////// DRAW MAIN MENU SCREEN CHANGE "GAME" AND "DEMO"////////////////////////////////////////////////////////////////// READ THIS!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// BOSS KEY//////////////////////////////////////////////////////////////////       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])////////////////////////////////////////////////////////////////// CHECK QUICK-KEYS & QUIT (WHILE IN A GAME)////////////////////////////////////////////////////////////////// END GAME QUICKSAVE Clear accumulated mouse movement QUICKLOAD loads lastgamemusicoffs Clear accumulated mouse movement QUIT////////////////////////////////////////////////////////////////// END THE CURRENT GAME//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// VIEW THE HIGH SCORES//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// START A NEW GAME////////////////////////////////////////////////////////////////// ALREADY IN A GAME? ALREADY IN A GAME? CHANGE "READ THIS!" TO NORMAL COLOR/////////////////// DRAW NEW EPISODE MENU/////////////////// DRAW NEW GAME MENU////////////////////// DRAW NEW GAME GRAPHIC////////////////////////////////////////////////////////////////// HANDLE SOUND MENU////////////////////////////////////////////////////////////////// HANDLE MENU CHOICES SOUND EFFECTS DIGITIZED SOUND                if (DigiMode != sds_SoundSource)
                {
                    SD_SetDigiDevice (sds_SoundSource);
                    DrawSoundMenu ();
                    ShootSnd ();
                } MUSIC//////////////////// DRAW THE SOUND MENU DRAW SOUND MENU IF NO ADLIB, NON-CHOOSENESS! DRAW SELECTED/NOT SELECTED GRAPHIC BUTTONS SOUND EFFECTS DIGITIZED SOUND                    if (DigiMode == sds_SoundSource)                        on = 1; MUSIC DRAW LOAD/SAVE IN PROGRESS////////////////////////////////////////////////////////////////// LOAD SAVED GAMES////////////////////////////////////////////////////////////////// QUICKLOAD? CHANGE "READ THIS!" TO NORMAL COLOR///////////////////////////////// HIGHLIGHT CURRENT SELECTED ENTRY////////////////////////// DRAW THE LOAD/SAVE SCREEN///////////////////////////////////////// PRINT LOAD/SAVE GAME ENTRY W/BOX OUTLINE////////////////////////////////////////////////////////////////// SAVE CURRENT GAME////////////////////////////////////////////////////////////////// QUICKSAVE? OVERWRITE EXISTING SAVEGAME?////////////////////////////////////////////////////////////////// DEFINE CONTROLS//////////////////////////////////////////////////////////////////////////////////////////////// DRAW MOUSE SENSITIVITY SCREEN///////////////////////// ADJUST MOUSE SENSITIVITY///////////////////////// DRAW CONTROL MENU SCREEN PICK FIRST AVAILABLE SPOT////////////////////////////////////////////////////////////////// CUSTOMIZE CONTROLS//////////////////////////////////////////////////////////////////////////////////////// DEFINE THE MOUSE BUTTONS////////////////////// DEFINE THE JOYSTICK BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// ENTER CONTROL DATA FOR ANY TYPE OF CONTROL FIND FIRST SPOT IN ALLOWED ARRAY CHANGE BUTTON VALUE? FLASH CURSOR WHICH TYPE OF INPUT DO WE PROCESS? EXIT INPUT? MOVE TO ANOTHER SPOT?////////////////////// FIXUP GUN CURSOR OVERDRAW SHIT////////////////////// DRAW CUSTOMIZE SCREEN MOUSE JOYSTICK/PAD KEYBOARD KEYBOARD MOVE KEYS PICK STARTING POINT IN MENU////////////////////////////////////////////////////////////////// CHANGE SCREEN VIEWING SIZE///////////////////////////////////////////////////////////////////////////////////////////// DRAW THE CHANGEVIEW SCREEN TODO: Check this!////////////////////////////////////////////////////////////////// QUIT THIS INFERNAL GAME!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// HANDLE INTRO SCREEN (SYSTEM CONFIG)////////////////////////////////////////////////////////////////// 0x4f 0x7f      long memory;      long emshere,xmshere;      int ems[10]={100,200,300,400,500,600,700,800,900,1000},
                xms[10]={100,200,300,400,500,600,700,800,900,1000};
        int main[10]={32,64,96,128,160,192,224,256,288,320}; DRAW MAIN MEMORY DRAW EMS MEMORY DRAW XMS MEMORY FILL BOXES    if (SoundSourcePresent)        VWB_Bar (164, 174, 12, 2, FILLCOLOR);//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SUPPORT ROUTINES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Clear Menu screens to dark red//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Un/Cache a LUMP of graphics//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a window for a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Setup Control Panel stuff - graphics, etc.////////////////////////////////////////////////////////////////// CACHE GRAPHICS & SOUNDS CENTER MOUSE////////////////////////////////////////////////////////////////// SEE WHICH SAVE GAME FILES ARE AVAILABLE & READ STRING IN////////////////////////////////////////////////////////////////// Try to unpack file Remove unpacked version of file////////////////////////////////////////////////////////////////// Clean up all the Control Panel stuff//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Handle moving gun around a menu////////////////////////////////////////////////////////////////// CALL CUSTOM ROUTINE IF IT IS NEEDED CHANGE GUN SHAPE SEE IF ANY KEYS ARE PRESSED FOR INITIAL CHAR FINDING DIDN'T FIND A MATCH FIRST TIME THRU. CHECK AGAIN. GET INPUT////////////////////////////////////////////// MOVE UP ANIMATE HALF-STEP MOVE TO NEXT AVAILABLE SPOT WAIT FOR BUTTON-UP OR DELAY NEXT MOVE////////////////////////////////////////////// MOVE DOWN ANIMATE HALF-STEP WAIT FOR BUTTON-UP OR DELAY NEXT MOVE ERASE EVERYTHING CALL THE ROUTINE JUST TO SHUT UP THE ERROR MESSAGES! ERASE GUN & DE-HIGHLIGHT STRING DRAW HALF STEP OF GUN TO NEXT POSITION DRAW GUN AT NEW POSITION CALL CUSTOM ROUTINE IF IT IS NEEDED////////////////////////////////////////////////////////////////// DELAY FOR AN AMOUNT OF TICS OR UNTIL CONTROLS ARE INACTIVE//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SET TEXT COLOR (HIGHLIGHT OR NO)//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// WAIT FOR CTRLKEY-UP OR BUTTON-UP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// READ KEYBOARD, JOYSTICK AND MOUSE FOR INPUT//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW DIALOG AND CONFIRM YES OR NO TO QUESTION////////////////////////////////////////////////////////////////// BLINK CURSOR////////////////////////////////////////////////////////////////// DRAW MESSAGE & GET Y OR N//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// PRINT A MESSAGE IN A WINDOW//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// THIS MAY BE FIXED A LITTLE LATER...///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////      IN_GetScanName() - Returns a string containing the name of the              specified scan code/////////////////////////////////////////////////////////////////////////    const char **p;
    ScanCode *s;

    for (s = ExtScanCodes, p = ExtScanNames; *s; p++, s++)
        if (*s == scan)
            return (*p);///////////////////////////////////////////////////////////////////////// CHECK FOR PAUSE KEY (FOR MUSIC ONLY)////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW GUN CURSOR AT CORRECT POSITION IN MENU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW SCREEN TITLE STRIPES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// CHECK FOR EPISODES///////////////////////////////////////////////////////////////////////// On Linux like systems, the configdir defaults to $HOME/.wolf4sdl Set config location to home directory for multi-user support Ensure config directory exists and create if necessary JAPANESE VERSION ENGLISH////////////////////////////////////////////////////////////////// WL_MENU.C by John Romero (C) 1992 Id Software, Inc.////////////////////////////////////////////////////////////////// PRIVATE PROTOTYPES ENDSTRx constants are defined in foreign.h CP_iteminfo struct format: short x, y, amount, curpos, indent;////////////////////////////////////////////////////////////////// INPUT MANAGER SCANCODE TABLES////////////////////////////////////////////////////////////////// Scan code names with single chars DEBUG - consolidate these Scan codes with >1 char names Names corresponding to ExtScanCodes#pragma warning 737 9
static byte
                                        *ScanNames[] =          // Scan code names with single chars
                                        {
        "?","?","1","2","3","4","5","6","7","8","9","0","-","+","?","?",
        "Q","W","E","R","T","Y","U","I","O","P","[","]","|","?","A","S",
        "D","F","G","H","J","K","L",";","\"","?","?","?","Z","X","C","V",
        "B","N","M",",",".","/","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","\xf","?","-","\x15","5","\x11","+","?",
        "\x13","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"
                                        };      // DEBUG - consolidate these
static byte ExtScanCodes[] =    // Scan codes with >1 char names
                                        {
        1,0xe,0xf,0x1d,0x2a,0x39,0x3a,0x3b,0x3c,0x3d,0x3e,
        0x3f,0x40,0x41,0x42,0x43,0x44,0x57,0x59,0x46,0x1c,0x36,
        0x37,0x38,0x47,0x49,0x4f,0x51,0x52,0x53,0x45,0x48,
        0x50,0x4b,0x4d,0x00
                                        };
static byte *ExtScanNames[] =   // Names corresponding to ExtScanCodes
                                        {
        "Esc","BkSp","Tab","Ctrl","LShft","Space","CapsLk","F1","F2","F3","F4",
        "F5","F6","F7","F8","F9","F10","F11","F12","ScrlLk","Enter","RShft",
        "PrtSc","Alt","Home","PgUp","End","PgDn","Ins","Del","NumLk","Up",
        "Down","Left","Right",""
                                        };   0   8  16  24  32  40  48  56  64  72  80  88  96 104 112 120 128 136 144 152 160 168 176 184 192 200 208 216 224 232 240 248 256 264 272 280 288 296 304 312 320////////////////////////////////////////////////////////////////// Wolfenstein Control Panel!  Ta Da!////////////////////////////////////////////////////////////////// F-KEYS FROM WITHIN GAME MAIN MENU LOOP EASTER EGG FOR SPEAR OF DESTINY! "EXIT OPTIONS" OR "NEW GAME" EXITS DEALLOCATE EVERYTHING CHANGE MAINMENU ITEM RETURN/START GAME EXECUTION////////////////////// DRAW MAIN MENU SCREEN CHANGE "GAME" AND "DEMO"////////////////////////////////////////////////////////////////// READ THIS!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// BOSS KEY//////////////////////////////////////////////////////////////////       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])////////////////////////////////////////////////////////////////// CHECK QUICK-KEYS & QUIT (WHILE IN A GAME)////////////////////////////////////////////////////////////////// END GAME QUICKSAVE Clear accumulated mouse movement QUICKLOAD loads lastgamemusicoffs Clear accumulated mouse movement QUIT////////////////////////////////////////////////////////////////// END THE CURRENT GAME//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// VIEW THE HIGH SCORES//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// START A NEW GAME////////////////////////////////////////////////////////////////// ALREADY IN A GAME? ALREADY IN A GAME? CHANGE "READ THIS!" TO NORMAL COLOR/////////////////// DRAW NEW EPISODE MENU/////////////////// DRAW NEW GAME MENU////////////////////// DRAW NEW GAME GRAPHIC////////////////////////////////////////////////////////////////// HANDLE SOUND MENU////////////////////////////////////////////////////////////////// HANDLE MENU CHOICES SOUND EFFECTS DIGITIZED SOUND                if (DigiMode != sds_SoundSource)
                {
                    SD_SetDigiDevice (sds_SoundSource);
                    DrawSoundMenu ();
                    ShootSnd ();
                } MUSIC//////////////////// DRAW THE SOUND MENU DRAW SOUND MENU IF NO ADLIB, NON-CHOOSENESS! DRAW SELECTED/NOT SELECTED GRAPHIC BUTTONS SOUND EFFECTS DIGITIZED SOUND                    if (DigiMode == sds_SoundSource)                        on = 1; MUSIC DRAW LOAD/SAVE IN PROGRESS////////////////////////////////////////////////////////////////// LOAD SAVED GAMES////////////////////////////////////////////////////////////////// QUICKLOAD? CHANGE "READ THIS!" TO NORMAL COLOR///////////////////////////////// HIGHLIGHT CURRENT SELECTED ENTRY////////////////////////// DRAW THE LOAD/SAVE SCREEN///////////////////////////////////////// PRINT LOAD/SAVE GAME ENTRY W/BOX OUTLINE////////////////////////////////////////////////////////////////// SAVE CURRENT GAME////////////////////////////////////////////////////////////////// QUICKSAVE? OVERWRITE EXISTING SAVEGAME?////////////////////////////////////////////////////////////////// DEFINE CONTROLS//////////////////////////////////////////////////////////////////////////////////////////////// DRAW MOUSE SENSITIVITY SCREEN///////////////////////// ADJUST MOUSE SENSITIVITY///////////////////////// DRAW CONTROL MENU SCREEN PICK FIRST AVAILABLE SPOT////////////////////////////////////////////////////////////////// CUSTOMIZE CONTROLS//////////////////////////////////////////////////////////////////////////////////////// DEFINE THE MOUSE BUTTONS////////////////////// DEFINE THE JOYSTICK BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// ENTER CONTROL DATA FOR ANY TYPE OF CONTROL FIND FIRST SPOT IN ALLOWED ARRAY CHANGE BUTTON VALUE? FLASH CURSOR WHICH TYPE OF INPUT DO WE PROCESS? EXIT INPUT? MOVE TO ANOTHER SPOT?////////////////////// FIXUP GUN CURSOR OVERDRAW SHIT////////////////////// DRAW CUSTOMIZE SCREEN MOUSE JOYSTICK/PAD KEYBOARD KEYBOARD MOVE KEYS PICK STARTING POINT IN MENU////////////////////////////////////////////////////////////////// CHANGE SCREEN VIEWING SIZE///////////////////////////////////////////////////////////////////////////////////////////// DRAW THE CHANGEVIEW SCREEN TODO: Check this!////////////////////////////////////////////////////////////////// QUIT THIS INFERNAL GAME!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// HANDLE INTRO SCREEN (SYSTEM CONFIG)////////////////////////////////////////////////////////////////// 0x4f 0x7f      long memory;      long emshere,xmshere;      int ems[10]={100,200,300,400,500,600,700,800,900,1000},
                xms[10]={100,200,300,400,500,600,700,800,900,1000};
        int main[10]={32,64,96,128,160,192,224,256,288,320}; DRAW MAIN MEMORY DRAW EMS MEMORY DRAW XMS MEMORY FILL BOXES    if (SoundSourcePresent)        VWB_Bar (164, 174, 12, 2, FILLCOLOR);//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SUPPORT ROUTINES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Clear Menu screens to dark red//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Un/Cache a LUMP of graphics//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a window for a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Setup Control Panel stuff - graphics, etc.////////////////////////////////////////////////////////////////// CACHE GRAPHICS & SOUNDS CENTER MOUSE////////////////////////////////////////////////////////////////// SEE WHICH SAVE GAME FILES ARE AVAILABLE & READ STRING IN////////////////////////////////////////////////////////////////// Try to unpack file Remove unpacked version of file////////////////////////////////////////////////////////////////// Clean up all the Control Panel stuff//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Handle moving gun around a menu////////////////////////////////////////////////////////////////// CALL CUSTOM ROUTINE IF IT IS NEEDED CHANGE GUN SHAPE SEE IF ANY KEYS ARE PRESSED FOR INITIAL CHAR FINDING DIDN'T FIND A MATCH FIRST TIME THRU. CHECK AGAIN. GET INPUT////////////////////////////////////////////// MOVE UP ANIMATE HALF-STEP MOVE TO NEXT AVAILABLE SPOT WAIT FOR BUTTON-UP OR DELAY NEXT MOVE////////////////////////////////////////////// MOVE DOWN ANIMATE HALF-STEP WAIT FOR BUTTON-UP OR DELAY NEXT MOVE ERASE EVERYTHING CALL THE ROUTINE JUST TO SHUT UP THE ERROR MESSAGES! ERASE GUN & DE-HIGHLIGHT STRING DRAW HALF STEP OF GUN TO NEXT POSITION DRAW GUN AT NEW POSITION CALL CUSTOM ROUTINE IF IT IS NEEDED////////////////////////////////////////////////////////////////// DELAY FOR AN AMOUNT OF TICS OR UNTIL CONTROLS ARE INACTIVE//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SET TEXT COLOR (HIGHLIGHT OR NO)//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// WAIT FOR CTRLKEY-UP OR BUTTON-UP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// READ KEYBOARD, JOYSTICK AND MOUSE FOR INPUT//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW DIALOG AND CONFIRM YES OR NO TO QUESTION////////////////////////////////////////////////////////////////// BLINK CURSOR////////////////////////////////////////////////////////////////// DRAW MESSAGE & GET Y OR N//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// PRINT A MESSAGE IN A WINDOW//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// THIS MAY BE FIXED A LITTLE LATER...///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////      IN_GetScanName() - Returns a string containing the name of the              specified scan code/////////////////////////////////////////////////////////////////////////    const char **p;
    ScanCode *s;

    for (s = ExtScanCodes, p = ExtScanNames; *s; p++, s++)
        if (*s == scan)
            return (*p);///////////////////////////////////////////////////////////////////////// CHECK FOR PAUSE KEY (FOR MUSIC ONLY)////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW GUN CURSOR AT CORRECT POSITION IN MENU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW SCREEN TITLE STRIPES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// CHECK FOR EPISODES///////////////////////////////////////////////////////////////////////// On Linux like systems, the configdir defaults to $HOME/.wolf4sdl Set config location to home directory for multi-user support Ensure config directory exists and create if necessary JAPANESE VERSION ENGLISH////////////////////////////////////////////////////////////////// WL_MENU.C by John Romero (C) 1992 Id Software, Inc.////////////////////////////////////////////////////////////////// PRIVATE PROTOTYPES ENDSTRx constants are defined in foreign.h CP_iteminfo struct format: short x, y, amount, curpos, indent;////////////////////////////////////////////////////////////////// INPUT MANAGER SCANCODE TABLES////////////////////////////////////////////////////////////////// Scan code names with single chars DEBUG - consolidate these Scan codes with >1 char names Names corresponding to ExtScanCodes#pragma warning 737 9
static byte
                                        *ScanNames[] =          // Scan code names with single chars
                                        {
        "?","?","1","2","3","4","5","6","7","8","9","0","-","+","?","?",
        "Q","W","E","R","T","Y","U","I","O","P","[","]","|","?","A","S",
        "D","F","G","H","J","K","L",";","\"","?","?","?","Z","X","C","V",
        "B","N","M",",",".","/","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","\xf","?","-","\x15","5","\x11","+","?",
        "\x13","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",
        "?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"
                                        };      // DEBUG - consolidate these
static byte ExtScanCodes[] =    // Scan codes with >1 char names
                                        {
        1,0xe,0xf,0x1d,0x2a,0x39,0x3a,0x3b,0x3c,0x3d,0x3e,
        0x3f,0x40,0x41,0x42,0x43,0x44,0x57,0x59,0x46,0x1c,0x36,
        0x37,0x38,0x47,0x49,0x4f,0x51,0x52,0x53,0x45,0x48,
        0x50,0x4b,0x4d,0x00
                                        };
static byte *ExtScanNames[] =   // Names corresponding to ExtScanCodes
                                        {
        "Esc","BkSp","Tab","Ctrl","LShft","Space","CapsLk","F1","F2","F3","F4",
        "F5","F6","F7","F8","F9","F10","F11","F12","ScrlLk","Enter","RShft",
        "PrtSc","Alt","Home","PgUp","End","PgDn","Ins","Del","NumLk","Up",
        "Down","Left","Right",""
                                        };   0   8  16  24  32  40  48  56  64  72  80  88  96 104 112 120 128 136 144 152 160 168 176 184 192 200 208 216 224 232 240 248 256 264 272 280 288 296 304 312 320////////////////////////////////////////////////////////////////// Wolfenstein Control Panel!  Ta Da!////////////////////////////////////////////////////////////////// F-KEYS FROM WITHIN GAME MAIN MENU LOOP EASTER EGG FOR SPEAR OF DESTINY! "EXIT OPTIONS" OR "NEW GAME" EXITS DEALLOCATE EVERYTHING CHANGE MAINMENU ITEM RETURN/START GAME EXECUTION////////////////////// DRAW MAIN MENU SCREEN CHANGE "GAME" AND "DEMO"////////////////////////////////////////////////////////////////// READ THIS!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// BOSS KEY//////////////////////////////////////////////////////////////////       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])       _AX = 3;
        geninterrupt(0x10);       while (!Keyboard[sc_Escape])////////////////////////////////////////////////////////////////// CHECK QUICK-KEYS & QUIT (WHILE IN A GAME)////////////////////////////////////////////////////////////////// END GAME QUICKSAVE Clear accumulated mouse movement QUICKLOAD loads lastgamemusicoffs Clear accumulated mouse movement QUIT////////////////////////////////////////////////////////////////// END THE CURRENT GAME//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// VIEW THE HIGH SCORES//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// START A NEW GAME////////////////////////////////////////////////////////////////// ALREADY IN A GAME? ALREADY IN A GAME? CHANGE "READ THIS!" TO NORMAL COLOR/////////////////// DRAW NEW EPISODE MENU/////////////////// DRAW NEW GAME MENU////////////////////// DRAW NEW GAME GRAPHIC////////////////////////////////////////////////////////////////// HANDLE SOUND MENU////////////////////////////////////////////////////////////////// HANDLE MENU CHOICES SOUND EFFECTS DIGITIZED SOUND                if (DigiMode != sds_SoundSource)
                {
                    SD_SetDigiDevice (sds_SoundSource);
                    DrawSoundMenu ();
                    ShootSnd ();
                } MUSIC//////////////////// DRAW THE SOUND MENU DRAW SOUND MENU IF NO ADLIB, NON-CHOOSENESS! DRAW SELECTED/NOT SELECTED GRAPHIC BUTTONS SOUND EFFECTS DIGITIZED SOUND                    if (DigiMode == sds_SoundSource)                        on = 1; MUSIC DRAW LOAD/SAVE IN PROGRESS////////////////////////////////////////////////////////////////// LOAD SAVED GAMES////////////////////////////////////////////////////////////////// QUICKLOAD? CHANGE "READ THIS!" TO NORMAL COLOR///////////////////////////////// HIGHLIGHT CURRENT SELECTED ENTRY////////////////////////// DRAW THE LOAD/SAVE SCREEN///////////////////////////////////////// PRINT LOAD/SAVE GAME ENTRY W/BOX OUTLINE////////////////////////////////////////////////////////////////// SAVE CURRENT GAME////////////////////////////////////////////////////////////////// QUICKSAVE? OVERWRITE EXISTING SAVEGAME?////////////////////////////////////////////////////////////////// DEFINE CONTROLS//////////////////////////////////////////////////////////////////////////////////////////////// DRAW MOUSE SENSITIVITY SCREEN///////////////////////// ADJUST MOUSE SENSITIVITY///////////////////////// DRAW CONTROL MENU SCREEN PICK FIRST AVAILABLE SPOT////////////////////////////////////////////////////////////////// CUSTOMIZE CONTROLS//////////////////////////////////////////////////////////////////////////////////////// DEFINE THE MOUSE BUTTONS////////////////////// DEFINE THE JOYSTICK BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// DEFINE THE KEYBOARD BUTTONS////////////////////// ENTER CONTROL DATA FOR ANY TYPE OF CONTROL FIND FIRST SPOT IN ALLOWED ARRAY CHANGE BUTTON VALUE? FLASH CURSOR WHICH TYPE OF INPUT DO WE PROCESS? EXIT INPUT? MOVE TO ANOTHER SPOT?////////////////////// FIXUP GUN CURSOR OVERDRAW SHIT////////////////////// DRAW CUSTOMIZE SCREEN MOUSE JOYSTICK/PAD KEYBOARD KEYBOARD MOVE KEYS PICK STARTING POINT IN MENU////////////////////////////////////////////////////////////////// CHANGE SCREEN VIEWING SIZE///////////////////////////////////////////////////////////////////////////////////////////// DRAW THE CHANGEVIEW SCREEN TODO: Check this!////////////////////////////////////////////////////////////////// QUIT THIS INFERNAL GAME!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// HANDLE INTRO SCREEN (SYSTEM CONFIG)////////////////////////////////////////////////////////////////// 0x4f 0x7f      long memory;      long emshere,xmshere;      int ems[10]={100,200,300,400,500,600,700,800,900,1000},
                xms[10]={100,200,300,400,500,600,700,800,900,1000};
        int main[10]={32,64,96,128,160,192,224,256,288,320}; DRAW MAIN MEMORY DRAW EMS MEMORY DRAW XMS MEMORY FILL BOXES    if (SoundSourcePresent)        VWB_Bar (164, 174, 12, 2, FILLCOLOR);//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SUPPORT ROUTINES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Clear Menu screens to dark red//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Un/Cache a LUMP of graphics//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a window for a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Setup Control Panel stuff - graphics, etc.////////////////////////////////////////////////////////////////// CACHE GRAPHICS & SOUNDS CENTER MOUSE////////////////////////////////////////////////////////////////// SEE WHICH SAVE GAME FILES ARE AVAILABLE & READ STRING IN////////////////////////////////////////////////////////////////// Try to unpack file Remove unpacked version of file////////////////////////////////////////////////////////////////// Clean up all the Control Panel stuff//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Handle moving gun around a menu////////////////////////////////////////////////////////////////// CALL CUSTOM ROUTINE IF IT IS NEEDED CHANGE GUN SHAPE SEE IF ANY KEYS ARE PRESSED FOR INITIAL CHAR FINDING DIDN'T FIND A MATCH FIRST TIME THRU. CHECK AGAIN. GET INPUT////////////////////////////////////////////// MOVE UP ANIMATE HALF-STEP MOVE TO NEXT AVAILABLE SPOT WAIT FOR BUTTON-UP OR DELAY NEXT MOVE////////////////////////////////////////////// MOVE DOWN ANIMATE HALF-STEP WAIT FOR BUTTON-UP OR DELAY NEXT MOVE ERASE EVERYTHING CALL THE ROUTINE JUST TO SHUT UP THE ERROR MESSAGES! ERASE GUN & DE-HIGHLIGHT STRING DRAW HALF STEP OF GUN TO NEXT POSITION DRAW GUN AT NEW POSITION CALL CUSTOM ROUTINE IF IT IS NEEDED////////////////////////////////////////////////////////////////// DELAY FOR AN AMOUNT OF TICS OR UNTIL CONTROLS ARE INACTIVE//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Draw a menu//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SET TEXT COLOR (HIGHLIGHT OR NO)//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// WAIT FOR CTRLKEY-UP OR BUTTON-UP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// READ KEYBOARD, JOYSTICK AND MOUSE FOR INPUT//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW DIALOG AND CONFIRM YES OR NO TO QUESTION////////////////////////////////////////////////////////////////// BLINK CURSOR////////////////////////////////////////////////////////////////// DRAW MESSAGE & GET Y OR N//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// PRINT A MESSAGE IN A WINDOW//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// THIS MAY BE FIXED A LITTLE LATER...///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////      IN_GetScanName() - Returns a string containing the name of the              specified scan code/////////////////////////////////////////////////////////////////////////    const char **p;
    ScanCode *s;

    for (s = ExtScanCodes, p = ExtScanNames; *s; p++, s++)
        if (*s == scan)
            return (*p);///////////////////////////////////////////////////////////////////////// CHECK FOR PAUSE KEY (FOR MUSIC ONLY)////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW GUN CURSOR AT CORRECT POSITION IN MENU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// DRAW SCREEN TITLE STRIPES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// CHECK FOR EPISODES///////////////////////////////////////////////////////////////////////// On Linux like systems, the configdir defaults to $HOME/.wolf4sdl Set config location to home directory for multi-user support Ensure config directory exists and create if necessary JAPANESE VERSION ENGLISH