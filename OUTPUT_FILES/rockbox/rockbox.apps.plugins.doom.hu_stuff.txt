 Emacs style mode select   -*- C++ -*-
 *-----------------------------------------------------------------------------
 *
 *
 *  PrBoom a Doom port merged with LxDoom and LSDLDoom
 *  based on BOOM, a modified and improved DOOM engine
 *  Copyright (C) 1999 by
 *  id Software, Chi Hoang, Lee Killough, Jim Flynn, Rand Phares, Ty Halderman
 *  Copyright (C) 1999-2000 by
 *  Jess Haas, Nicolas Kalkhof, Colin Phipps, Florian Schulze
 *
 *  This program is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU General Public License
 *  as published by the Free Software Foundation; either version 2
 *  of the License, or (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 *  02111-1307, USA.
 *
 * DESCRIPTION:  Heads-up displays
 *
 *-----------------------------------------------------------------------------
  killough 5/3/98: remove unnecessary headers jff 2/16/98 need loc of status bar #include "d_deh.h"   /* Ty 03/27/98 - externalization of mapnamesx arrays */ global heads up display controlsjff 2/17/98 controls heads-up display modejff 2/23/98 turns heads-up display on/offjff 2/18/98 allows secrets line to be disabled in HUDjff 3/4/98 display HUD in different places on screenjff 3/7/98 display HUD keys as graphics Locally used constants, shortcuts. Ty 03/28/98 - These four shortcuts modifed to reflect char ** of mapnamesx[]jff 2/16/98 change 167 to ST_Y-1 CPhipps - changed to ST_TY proff - changed to 200-ST_HEIGHT for stretchingjff 2/16/98 add coord text widget coordinates proff - changed to SCREENWIDTH to 320 for stretchingjff 3/3/98 split coord widget into three lines in upper right of screenjff 2/16/98 add ammo, health, armor widgets, 2/22/98 less gapjff 3/7/98 add offset for graphic key widgetjff 3/4/98 distributed HUD positions proff/nicolas 09/20/98: Changed for high-res proff/nicolas 09/20/98: Changed for high-res#define HU_INPUTTOGGLE  't' // not used                           // phares Ty 03/27/98 - *not* externalized CPhipps - const char* Ty 03/27/98 - *not* externalized CPhipps - const char*jff 3/17/98 translate player colmap to text color ranges remove later. font setsjff 3/7/98 added for graphic key indicatorsjff 2/26/98 add patches for message background widgetsjff 2/16/98 new coord widget for automapjff 3/3/98 split coord widgets automapjff 3/3/98 split coord widgets automapjff 2/16/98 new ammo widget for hudjff 2/16/98 new health widget for hudjff 2/16/98 new armor widget for hudjff 2/16/98 new weapon widget for hudjff 2/16/98 new keys widget for hudjff 3/7/98 graphic keys widget for hudjff 2/16/98 new kill/secret widget for hudjff 2/26/98 text message refresh widget2/26/98 enable showing list of messagesjff 2/16/98 hud supported automap colors added color range of automap level title color range of new coords on automapjff 2/16/98 hud text colors, controls added color range of scrolling messages color range of chat lines number of message lines in windowjff 2/26/98 hud text colors, controls added list of messages color enable for solid window background for message listjff 2/16/98 initialization strings for ammo, health, armor widgetsjff 3/7/98 add support for graphic key displayjff 2/16/98 declaration of color switch points key tables jff 5/10/98 french support removed, as it was not being used and couldn't be easily tested shift-' shift-, shift-- shift-. shift-/ shift-0 shift-1 shift-2 shift-3 shift-4 shift-5 shift-6 shift-7 shift-8 shift-9 shift-; shift-= shift-[ shift-backslash - OH MY GOD DOES WATCOM SUCK shift-] shift-` HU_Init() Initialize the heads-up display, text that overwrites the primary display Passed nothing, returns nothing malloc all the strings, trying to get size down load the heads-up fontjff 2/23/98 make all font chars defined, useful or notjff 2/16/98 account for gap CPhipps - load patches for message background CPhipps - load patches for keys and double keys HU_Stop() Make the heads-up displays inactive Passed nothing, returns nothing HU_Start(void) Create and initialize the heads-up widgets, software machines to maintain, update, and display information over the primary display This routine must be called after any change to the heads up configuration in order for the changes to take effect in the actual displays Passed nothing, returns nothing cph - const  stop before starting killough 3/7/98 create the message widget messages to player in upper-left of screenjff 2/16/98 added some HUD widgets create the map title widget - map title display in lower left of automap create the hud health widget bargraph and number for amount of health, lower left or upper right of screen3/4/98 distribute create the hud armor widget bargraph and number for amount of armor, lower left or upper right of screen3/4/98 distribute create the hud ammo widget bargraph and number for amount of ammo for current weapon, lower left or lower right of screen3/4/98 distribute create the hud weapons widget list of numbers of weapons possessed lower left or lower right of screen3/4/98 distribute create the hud keys widget display of key letters possessed lower left of screen3/4/98 distribute create the hud graphic keys widget display of key graphics possessed lower left of screen3/4/98 distribute create the hud monster/secret widget totals and current values for kills, items, secrets lower left of screen3/4/98 distribute create the hud text refresh widget scrolling display of last hud_msg_lines messages receivedjff 4/21/98 if setup has disabled message list while active, turn it offjff 8/8/98 initialize both waysjff 2/26/98 add the text refresh widget initialization    SCREENWIDTH, initialize the automap's level title widget cph - stop SEGV here when not in level  Ty 08/27/98 - modified to check mission for TNT/Plutonia create the automaps coordinate widget jff 3/3/98 split coord widget into three lines: x,y,z jff 2/16/98 added initialize the automaps coordinate widgetjff 3/3/98 split coordstr widget into 3 partsjff 2/22/98 added zjff 3/3/98 split x,y,zjff 3/3/98 split x,y,zjff 2/16/98 initialize ammo widgetjff 2/16/98 initialize health widgetjff 2/16/98 initialize armor widgetjff 2/17/98 initialize weapons widgetjff 2/17/98 initialize keys widgetjff 3/17/98 show frags in deathmatch modejff 2/17/98 initialize graphic keys widgetjff 2/17/98 initialize kills/items/secret widget create the chat widget create the inputbuffer widgets, one per player now allow the heads-up display to run HU_MoveHud() Move the HUD display from distributed to compact mode or vice-versa Passed nothing, returns nothingjff 3/9/98 create this externally callable to avoid glitch when menu scatter's HUD due to delay in change of positionjff 3/4/98 move displays around on F5 changing hud_distributed HU_Drawer() Draw all the pieces of the heads-up display Passed nothing, returns nothingjff 3/8/98 allow plenty room for dehacked modsjffjff killough 3/7/98 draw the automap widgets if automap is displayed map titlejff 2/16/98 output new coord display x-coordjff 3/3/98 split coord display into x,y,z lines y-coordjff 3/3/98 split coord display into x,y,z linesjff 2/22/98 added z z-coord draw the weapon/health/ammo/armor/kills/keys displays if optionedjff 2/17/98 allow new hud stuff to be turned off killough 2/21/98: really allow new hud stuff to be turned off COMPLETELY hud optioned on hud on from fullscreen key fullscreen mode is active automap is not activejff 3/4/98 speed update up for slow systemsjff 8/7/98 update every time, avoid lag in update insure HUD display coords are correct do the hud ammo display clear the widgets internal line special case for weapon with no ammo selected - blank bargraph + N/A build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the percentage of total ammo held transfer the init string to the widget display the ammo widget every frame do the hud health display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of health posessed transfer the init string to the widget display the health widget every frame do the hud armor display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of armor posessed transfer the init string to the widget display the armor widget every frame do the hud weapon display clear the widgets internal linejff 3/7/98 make sure ammo goes away do each weapon that exists in current gamemodejff 3/4/98 show fists too, why not?jff avoid executing for weapons that do not exist skip weapons not currently posessed display each weapon number in a color related to the ammo for itjff 3/26/98 use ESC not '\' for pathsjff 3/14/98 show berserk on HUD transfer the init string to the widget display the weapon widget every framejff 3/7/98 make sure deleted keys go awayjff add case for graphic key displayjff 3/7/98 init graphic keys widget string build text string whose characters call out graphic keys from fontk skip keys not possessed key number plus '!' is char for key spacing not possible in current code, unless deathmatching,jff 3/7/98 make sure deleted keys go away if deathmatch, build string showing top four frag countsjff 3/17/98 show frags, not keys, in deathmatch scan thru players skip players not in game compute number of times they've fragged each player minus number of times they've been fragged by them very primitive sort of frags to find top four if the biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the second biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the third biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the fourth biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for pathsjff 3/17/98 end of deathmatch clause build alphabetical key display (not used currently) scan the keys skip any not possessed by the displayed player's stats use color escapes to make text in key's colorjff 3/26/98 use ESC not '\' for paths display the keys/frags line each frame clear the widget strings transfer the built string (frags or key title) to the widgetjff 3/7/98 display key titles/key text or fragsjff 3/17/98 show graphic keys in non-DM onlyjff 3/7/98 display graphic keys transfer the graphic key text to the widget display the widget display the hud kills/items/secret display if optioned clear the internal widget text bufferjff 3/26/98 use ESC not '\' for paths build the init string with fixed colors transfer the init string to the widget display the kills/items/secrets each frame, if optionedjff 3/4/98 display last to give priority jff 4/24/98 Erase current lines before drawing current needed when screen not fullsizejff 4/21/98 if setup has disabled message list while active, turn it off if the message review not enabled, show the standard message widget if the message review is enabled show the scrolling message review display the interactive buffer for chat entry HU_Erase() Erase hud display lines that can be trashed by small screen display Passed nothing, returns nothing erase the message display or the message review display erase the interactive text buffer for chat entry erase the automap title HU_Ticker() Update the hud displays once per frame Passed nothing, returns nothing Is backspace down? tick down message counter if message is up if messages on, or "Messages Off" is being displayed this allows the notification of turning messages off to be seen display message if necessarypost the message to the message widgetjff 2/26/98 add message to refresh text widget too clear the message to avoid posting multiple times note a message is displayed start the message persistence counter transfer "Messages Off" exception to the "being displayed" variable clear the flag that "Messages Off" is being posted check for incoming chat characters HU_queueChatChar() Add an incoming character to the circular chat queue Passed the character to queue, returns nothing HU_dequeueChatChar() Remove the earliest added character from the circular chat queue Passed nothing, returns the character dequeued HU_Responder() Responds to input events that affect the heads up displays Passed the event to respond to, returns true if the event was handled CPhipps - const char* phares never turn on message review if INSTRUMENTED defined it posts multi-line messages that will trashjff 4/28/98 erase behind messagesjff 2/26/98 toggle list of messages if not message list, refresh messagejff 2/26/98 no chat if message review is displayedjff 2/26/98  no chat if message review is displayed killough 10/02/98: no chat if demo playbackjff 2/26/98 no chat functions if message review is displayed send a macro kill last message with a '\n' DEBUG!!!                // phares send the macro message phares leave chat mode and notify that it was sent phares phares Emacs style mode select   -*- C++ -*-
 *-----------------------------------------------------------------------------
 *
 *
 *  PrBoom a Doom port merged with LxDoom and LSDLDoom
 *  based on BOOM, a modified and improved DOOM engine
 *  Copyright (C) 1999 by
 *  id Software, Chi Hoang, Lee Killough, Jim Flynn, Rand Phares, Ty Halderman
 *  Copyright (C) 1999-2000 by
 *  Jess Haas, Nicolas Kalkhof, Colin Phipps, Florian Schulze
 *
 *  This program is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU General Public License
 *  as published by the Free Software Foundation; either version 2
 *  of the License, or (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 *  02111-1307, USA.
 *
 * DESCRIPTION:  Heads-up displays
 *
 *-----------------------------------------------------------------------------
  killough 5/3/98: remove unnecessary headers jff 2/16/98 need loc of status bar #include "d_deh.h"   /* Ty 03/27/98 - externalization of mapnamesx arrays */ global heads up display controlsjff 2/17/98 controls heads-up display modejff 2/23/98 turns heads-up display on/offjff 2/18/98 allows secrets line to be disabled in HUDjff 3/4/98 display HUD in different places on screenjff 3/7/98 display HUD keys as graphics Locally used constants, shortcuts. Ty 03/28/98 - These four shortcuts modifed to reflect char ** of mapnamesx[]jff 2/16/98 change 167 to ST_Y-1 CPhipps - changed to ST_TY proff - changed to 200-ST_HEIGHT for stretchingjff 2/16/98 add coord text widget coordinates proff - changed to SCREENWIDTH to 320 for stretchingjff 3/3/98 split coord widget into three lines in upper right of screenjff 2/16/98 add ammo, health, armor widgets, 2/22/98 less gapjff 3/7/98 add offset for graphic key widgetjff 3/4/98 distributed HUD positions proff/nicolas 09/20/98: Changed for high-res proff/nicolas 09/20/98: Changed for high-res#define HU_INPUTTOGGLE  't' // not used                           // phares Ty 03/27/98 - *not* externalized CPhipps - const char* Ty 03/27/98 - *not* externalized CPhipps - const char*jff 3/17/98 translate player colmap to text color ranges remove later. font setsjff 3/7/98 added for graphic key indicatorsjff 2/26/98 add patches for message background widgetsjff 2/16/98 new coord widget for automapjff 3/3/98 split coord widgets automapjff 3/3/98 split coord widgets automapjff 2/16/98 new ammo widget for hudjff 2/16/98 new health widget for hudjff 2/16/98 new armor widget for hudjff 2/16/98 new weapon widget for hudjff 2/16/98 new keys widget for hudjff 3/7/98 graphic keys widget for hudjff 2/16/98 new kill/secret widget for hudjff 2/26/98 text message refresh widget2/26/98 enable showing list of messagesjff 2/16/98 hud supported automap colors added color range of automap level title color range of new coords on automapjff 2/16/98 hud text colors, controls added color range of scrolling messages color range of chat lines number of message lines in windowjff 2/26/98 hud text colors, controls added list of messages color enable for solid window background for message listjff 2/16/98 initialization strings for ammo, health, armor widgetsjff 3/7/98 add support for graphic key displayjff 2/16/98 declaration of color switch points key tables jff 5/10/98 french support removed, as it was not being used and couldn't be easily tested shift-' shift-, shift-- shift-. shift-/ shift-0 shift-1 shift-2 shift-3 shift-4 shift-5 shift-6 shift-7 shift-8 shift-9 shift-; shift-= shift-[ shift-backslash - OH MY GOD DOES WATCOM SUCK shift-] shift-` HU_Init() Initialize the heads-up display, text that overwrites the primary display Passed nothing, returns nothing malloc all the strings, trying to get size down load the heads-up fontjff 2/23/98 make all font chars defined, useful or notjff 2/16/98 account for gap CPhipps - load patches for message background CPhipps - load patches for keys and double keys HU_Stop() Make the heads-up displays inactive Passed nothing, returns nothing HU_Start(void) Create and initialize the heads-up widgets, software machines to maintain, update, and display information over the primary display This routine must be called after any change to the heads up configuration in order for the changes to take effect in the actual displays Passed nothing, returns nothing cph - const  stop before starting killough 3/7/98 create the message widget messages to player in upper-left of screenjff 2/16/98 added some HUD widgets create the map title widget - map title display in lower left of automap create the hud health widget bargraph and number for amount of health, lower left or upper right of screen3/4/98 distribute create the hud armor widget bargraph and number for amount of armor, lower left or upper right of screen3/4/98 distribute create the hud ammo widget bargraph and number for amount of ammo for current weapon, lower left or lower right of screen3/4/98 distribute create the hud weapons widget list of numbers of weapons possessed lower left or lower right of screen3/4/98 distribute create the hud keys widget display of key letters possessed lower left of screen3/4/98 distribute create the hud graphic keys widget display of key graphics possessed lower left of screen3/4/98 distribute create the hud monster/secret widget totals and current values for kills, items, secrets lower left of screen3/4/98 distribute create the hud text refresh widget scrolling display of last hud_msg_lines messages receivedjff 4/21/98 if setup has disabled message list while active, turn it offjff 8/8/98 initialize both waysjff 2/26/98 add the text refresh widget initialization    SCREENWIDTH, initialize the automap's level title widget cph - stop SEGV here when not in level  Ty 08/27/98 - modified to check mission for TNT/Plutonia create the automaps coordinate widget jff 3/3/98 split coord widget into three lines: x,y,z jff 2/16/98 added initialize the automaps coordinate widgetjff 3/3/98 split coordstr widget into 3 partsjff 2/22/98 added zjff 3/3/98 split x,y,zjff 3/3/98 split x,y,zjff 2/16/98 initialize ammo widgetjff 2/16/98 initialize health widgetjff 2/16/98 initialize armor widgetjff 2/17/98 initialize weapons widgetjff 2/17/98 initialize keys widgetjff 3/17/98 show frags in deathmatch modejff 2/17/98 initialize graphic keys widgetjff 2/17/98 initialize kills/items/secret widget create the chat widget create the inputbuffer widgets, one per player now allow the heads-up display to run HU_MoveHud() Move the HUD display from distributed to compact mode or vice-versa Passed nothing, returns nothingjff 3/9/98 create this externally callable to avoid glitch when menu scatter's HUD due to delay in change of positionjff 3/4/98 move displays around on F5 changing hud_distributed HU_Drawer() Draw all the pieces of the heads-up display Passed nothing, returns nothingjff 3/8/98 allow plenty room for dehacked modsjffjff killough 3/7/98 draw the automap widgets if automap is displayed map titlejff 2/16/98 output new coord display x-coordjff 3/3/98 split coord display into x,y,z lines y-coordjff 3/3/98 split coord display into x,y,z linesjff 2/22/98 added z z-coord draw the weapon/health/ammo/armor/kills/keys displays if optionedjff 2/17/98 allow new hud stuff to be turned off killough 2/21/98: really allow new hud stuff to be turned off COMPLETELY hud optioned on hud on from fullscreen key fullscreen mode is active automap is not activejff 3/4/98 speed update up for slow systemsjff 8/7/98 update every time, avoid lag in update insure HUD display coords are correct do the hud ammo display clear the widgets internal line special case for weapon with no ammo selected - blank bargraph + N/A build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the percentage of total ammo held transfer the init string to the widget display the ammo widget every frame do the hud health display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of health posessed transfer the init string to the widget display the health widget every frame do the hud armor display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of armor posessed transfer the init string to the widget display the armor widget every frame do the hud weapon display clear the widgets internal linejff 3/7/98 make sure ammo goes away do each weapon that exists in current gamemodejff 3/4/98 show fists too, why not?jff avoid executing for weapons that do not exist skip weapons not currently posessed display each weapon number in a color related to the ammo for itjff 3/26/98 use ESC not '\' for pathsjff 3/14/98 show berserk on HUD transfer the init string to the widget display the weapon widget every framejff 3/7/98 make sure deleted keys go awayjff add case for graphic key displayjff 3/7/98 init graphic keys widget string build text string whose characters call out graphic keys from fontk skip keys not possessed key number plus '!' is char for key spacing not possible in current code, unless deathmatching,jff 3/7/98 make sure deleted keys go away if deathmatch, build string showing top four frag countsjff 3/17/98 show frags, not keys, in deathmatch scan thru players skip players not in game compute number of times they've fragged each player minus number of times they've been fragged by them very primitive sort of frags to find top four if the biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the second biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the third biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the fourth biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for pathsjff 3/17/98 end of deathmatch clause build alphabetical key display (not used currently) scan the keys skip any not possessed by the displayed player's stats use color escapes to make text in key's colorjff 3/26/98 use ESC not '\' for paths display the keys/frags line each frame clear the widget strings transfer the built string (frags or key title) to the widgetjff 3/7/98 display key titles/key text or fragsjff 3/17/98 show graphic keys in non-DM onlyjff 3/7/98 display graphic keys transfer the graphic key text to the widget display the widget display the hud kills/items/secret display if optioned clear the internal widget text bufferjff 3/26/98 use ESC not '\' for paths build the init string with fixed colors transfer the init string to the widget display the kills/items/secrets each frame, if optionedjff 3/4/98 display last to give priority jff 4/24/98 Erase current lines before drawing current needed when screen not fullsizejff 4/21/98 if setup has disabled message list while active, turn it off if the message review not enabled, show the standard message widget if the message review is enabled show the scrolling message review display the interactive buffer for chat entry HU_Erase() Erase hud display lines that can be trashed by small screen display Passed nothing, returns nothing erase the message display or the message review display erase the interactive text buffer for chat entry erase the automap title HU_Ticker() Update the hud displays once per frame Passed nothing, returns nothing Is backspace down? tick down message counter if message is up if messages on, or "Messages Off" is being displayed this allows the notification of turning messages off to be seen display message if necessarypost the message to the message widgetjff 2/26/98 add message to refresh text widget too clear the message to avoid posting multiple times note a message is displayed start the message persistence counter transfer "Messages Off" exception to the "being displayed" variable clear the flag that "Messages Off" is being posted check for incoming chat characters HU_queueChatChar() Add an incoming character to the circular chat queue Passed the character to queue, returns nothing HU_dequeueChatChar() Remove the earliest added character from the circular chat queue Passed nothing, returns the character dequeued HU_Responder() Responds to input events that affect the heads up displays Passed the event to respond to, returns true if the event was handled CPhipps - const char* phares never turn on message review if INSTRUMENTED defined it posts multi-line messages that will trashjff 4/28/98 erase behind messagesjff 2/26/98 toggle list of messages if not message list, refresh messagejff 2/26/98 no chat if message review is displayedjff 2/26/98  no chat if message review is displayed killough 10/02/98: no chat if demo playbackjff 2/26/98 no chat functions if message review is displayed send a macro kill last message with a '\n' DEBUG!!!                // phares send the macro message phares leave chat mode and notify that it was sent phares phares Emacs style mode select   -*- C++ -*-
 *-----------------------------------------------------------------------------
 *
 *
 *  PrBoom a Doom port merged with LxDoom and LSDLDoom
 *  based on BOOM, a modified and improved DOOM engine
 *  Copyright (C) 1999 by
 *  id Software, Chi Hoang, Lee Killough, Jim Flynn, Rand Phares, Ty Halderman
 *  Copyright (C) 1999-2000 by
 *  Jess Haas, Nicolas Kalkhof, Colin Phipps, Florian Schulze
 *
 *  This program is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU General Public License
 *  as published by the Free Software Foundation; either version 2
 *  of the License, or (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 *  02111-1307, USA.
 *
 * DESCRIPTION:  Heads-up displays
 *
 *-----------------------------------------------------------------------------
  killough 5/3/98: remove unnecessary headers jff 2/16/98 need loc of status bar #include "d_deh.h"   /* Ty 03/27/98 - externalization of mapnamesx arrays */ global heads up display controlsjff 2/17/98 controls heads-up display modejff 2/23/98 turns heads-up display on/offjff 2/18/98 allows secrets line to be disabled in HUDjff 3/4/98 display HUD in different places on screenjff 3/7/98 display HUD keys as graphics Locally used constants, shortcuts. Ty 03/28/98 - These four shortcuts modifed to reflect char ** of mapnamesx[]jff 2/16/98 change 167 to ST_Y-1 CPhipps - changed to ST_TY proff - changed to 200-ST_HEIGHT for stretchingjff 2/16/98 add coord text widget coordinates proff - changed to SCREENWIDTH to 320 for stretchingjff 3/3/98 split coord widget into three lines in upper right of screenjff 2/16/98 add ammo, health, armor widgets, 2/22/98 less gapjff 3/7/98 add offset for graphic key widgetjff 3/4/98 distributed HUD positions proff/nicolas 09/20/98: Changed for high-res proff/nicolas 09/20/98: Changed for high-res#define HU_INPUTTOGGLE  't' // not used                           // phares Ty 03/27/98 - *not* externalized CPhipps - const char* Ty 03/27/98 - *not* externalized CPhipps - const char*jff 3/17/98 translate player colmap to text color ranges remove later. font setsjff 3/7/98 added for graphic key indicatorsjff 2/26/98 add patches for message background widgetsjff 2/16/98 new coord widget for automapjff 3/3/98 split coord widgets automapjff 3/3/98 split coord widgets automapjff 2/16/98 new ammo widget for hudjff 2/16/98 new health widget for hudjff 2/16/98 new armor widget for hudjff 2/16/98 new weapon widget for hudjff 2/16/98 new keys widget for hudjff 3/7/98 graphic keys widget for hudjff 2/16/98 new kill/secret widget for hudjff 2/26/98 text message refresh widget2/26/98 enable showing list of messagesjff 2/16/98 hud supported automap colors added color range of automap level title color range of new coords on automapjff 2/16/98 hud text colors, controls added color range of scrolling messages color range of chat lines number of message lines in windowjff 2/26/98 hud text colors, controls added list of messages color enable for solid window background for message listjff 2/16/98 initialization strings for ammo, health, armor widgetsjff 3/7/98 add support for graphic key displayjff 2/16/98 declaration of color switch points key tables jff 5/10/98 french support removed, as it was not being used and couldn't be easily tested shift-' shift-, shift-- shift-. shift-/ shift-0 shift-1 shift-2 shift-3 shift-4 shift-5 shift-6 shift-7 shift-8 shift-9 shift-; shift-= shift-[ shift-backslash - OH MY GOD DOES WATCOM SUCK shift-] shift-` HU_Init() Initialize the heads-up display, text that overwrites the primary display Passed nothing, returns nothing malloc all the strings, trying to get size down load the heads-up fontjff 2/23/98 make all font chars defined, useful or notjff 2/16/98 account for gap CPhipps - load patches for message background CPhipps - load patches for keys and double keys HU_Stop() Make the heads-up displays inactive Passed nothing, returns nothing HU_Start(void) Create and initialize the heads-up widgets, software machines to maintain, update, and display information over the primary display This routine must be called after any change to the heads up configuration in order for the changes to take effect in the actual displays Passed nothing, returns nothing cph - const  stop before starting killough 3/7/98 create the message widget messages to player in upper-left of screenjff 2/16/98 added some HUD widgets create the map title widget - map title display in lower left of automap create the hud health widget bargraph and number for amount of health, lower left or upper right of screen3/4/98 distribute create the hud armor widget bargraph and number for amount of armor, lower left or upper right of screen3/4/98 distribute create the hud ammo widget bargraph and number for amount of ammo for current weapon, lower left or lower right of screen3/4/98 distribute create the hud weapons widget list of numbers of weapons possessed lower left or lower right of screen3/4/98 distribute create the hud keys widget display of key letters possessed lower left of screen3/4/98 distribute create the hud graphic keys widget display of key graphics possessed lower left of screen3/4/98 distribute create the hud monster/secret widget totals and current values for kills, items, secrets lower left of screen3/4/98 distribute create the hud text refresh widget scrolling display of last hud_msg_lines messages receivedjff 4/21/98 if setup has disabled message list while active, turn it offjff 8/8/98 initialize both waysjff 2/26/98 add the text refresh widget initialization    SCREENWIDTH, initialize the automap's level title widget cph - stop SEGV here when not in level  Ty 08/27/98 - modified to check mission for TNT/Plutonia create the automaps coordinate widget jff 3/3/98 split coord widget into three lines: x,y,z jff 2/16/98 added initialize the automaps coordinate widgetjff 3/3/98 split coordstr widget into 3 partsjff 2/22/98 added zjff 3/3/98 split x,y,zjff 3/3/98 split x,y,zjff 2/16/98 initialize ammo widgetjff 2/16/98 initialize health widgetjff 2/16/98 initialize armor widgetjff 2/17/98 initialize weapons widgetjff 2/17/98 initialize keys widgetjff 3/17/98 show frags in deathmatch modejff 2/17/98 initialize graphic keys widgetjff 2/17/98 initialize kills/items/secret widget create the chat widget create the inputbuffer widgets, one per player now allow the heads-up display to run HU_MoveHud() Move the HUD display from distributed to compact mode or vice-versa Passed nothing, returns nothingjff 3/9/98 create this externally callable to avoid glitch when menu scatter's HUD due to delay in change of positionjff 3/4/98 move displays around on F5 changing hud_distributed HU_Drawer() Draw all the pieces of the heads-up display Passed nothing, returns nothingjff 3/8/98 allow plenty room for dehacked modsjffjff killough 3/7/98 draw the automap widgets if automap is displayed map titlejff 2/16/98 output new coord display x-coordjff 3/3/98 split coord display into x,y,z lines y-coordjff 3/3/98 split coord display into x,y,z linesjff 2/22/98 added z z-coord draw the weapon/health/ammo/armor/kills/keys displays if optionedjff 2/17/98 allow new hud stuff to be turned off killough 2/21/98: really allow new hud stuff to be turned off COMPLETELY hud optioned on hud on from fullscreen key fullscreen mode is active automap is not activejff 3/4/98 speed update up for slow systemsjff 8/7/98 update every time, avoid lag in update insure HUD display coords are correct do the hud ammo display clear the widgets internal line special case for weapon with no ammo selected - blank bargraph + N/A build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the percentage of total ammo held transfer the init string to the widget display the ammo widget every frame do the hud health display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of health posessed transfer the init string to the widget display the health widget every frame do the hud armor display clear the widgets internal line build the numeric amount init string build the bargraph string full bargraph chars plus one last character with 0,1,2,3 bars pad string with blank bar characters set the display color from the amount of armor posessed transfer the init string to the widget display the armor widget every frame do the hud weapon display clear the widgets internal linejff 3/7/98 make sure ammo goes away do each weapon that exists in current gamemodejff 3/4/98 show fists too, why not?jff avoid executing for weapons that do not exist skip weapons not currently posessed display each weapon number in a color related to the ammo for itjff 3/26/98 use ESC not '\' for pathsjff 3/14/98 show berserk on HUD transfer the init string to the widget display the weapon widget every framejff 3/7/98 make sure deleted keys go awayjff add case for graphic key displayjff 3/7/98 init graphic keys widget string build text string whose characters call out graphic keys from fontk skip keys not possessed key number plus '!' is char for key spacing not possible in current code, unless deathmatching,jff 3/7/98 make sure deleted keys go away if deathmatch, build string showing top four frag countsjff 3/17/98 show frags, not keys, in deathmatch scan thru players skip players not in game compute number of times they've fragged each player minus number of times they've been fragged by them very primitive sort of frags to find top four if the biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the second biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the third biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for paths if the fourth biggest number exists, put it in the init string make frag count in player's color via escape codejff 3/26/98 use ESC not '\' for pathsjff 3/17/98 end of deathmatch clause build alphabetical key display (not used currently) scan the keys skip any not possessed by the displayed player's stats use color escapes to make text in key's colorjff 3/26/98 use ESC not '\' for paths display the keys/frags line each frame clear the widget strings transfer the built string (frags or key title) to the widgetjff 3/7/98 display key titles/key text or fragsjff 3/17/98 show graphic keys in non-DM onlyjff 3/7/98 display graphic keys transfer the graphic key text to the widget display the widget display the hud kills/items/secret display if optioned clear the internal widget text bufferjff 3/26/98 use ESC not '\' for paths build the init string with fixed colors transfer the init string to the widget display the kills/items/secrets each frame, if optionedjff 3/4/98 display last to give priority jff 4/24/98 Erase current lines before drawing current needed when screen not fullsizejff 4/21/98 if setup has disabled message list while active, turn it off if the message review not enabled, show the standard message widget if the message review is enabled show the scrolling message review display the interactive buffer for chat entry HU_Erase() Erase hud display lines that can be trashed by small screen display Passed nothing, returns nothing erase the message display or the message review display erase the interactive text buffer for chat entry erase the automap title HU_Ticker() Update the hud displays once per frame Passed nothing, returns nothing Is backspace down? tick down message counter if message is up if messages on, or "Messages Off" is being displayed this allows the notification of turning messages off to be seen display message if necessarypost the message to the message widgetjff 2/26/98 add message to refresh text widget too clear the message to avoid posting multiple times note a message is displayed start the message persistence counter transfer "Messages Off" exception to the "being displayed" variable clear the flag that "Messages Off" is being posted check for incoming chat characters HU_queueChatChar() Add an incoming character to the circular chat queue Passed the character to queue, returns nothing HU_dequeueChatChar() Remove the earliest added character from the circular chat queue Passed nothing, returns the character dequeued HU_Responder() Responds to input events that affect the heads up displays Passed the event to respond to, returns true if the event was handled CPhipps - const char* phares never turn on message review if INSTRUMENTED defined it posts multi-line messages that will trashjff 4/28/98 erase behind messagesjff 2/26/98 toggle list of messages if not message list, refresh messagejff 2/26/98 no chat if message review is displayedjff 2/26/98  no chat if message review is displayed killough 10/02/98: no chat if demo playbackjff 2/26/98 no chat functions if message review is displayed send a macro kill last message with a '\n' DEBUG!!!                // phares send the macro message phares leave chat mode and notify that it was sent phares phares