 Game_Music_Emu 0.5.5. http://www.slack.net/~ant/ Copyright (C) 2003-2006 Shay Green. This module is free software; you
can redistribute it and/or modify it under the terms of the GNU Lesser
General Public License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version. This
module is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
details. You should have received a copy of the GNU Lesser General Public
License along with this module; if not, write to the Free Software Foundation,
Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA  FM emulators are internally quieter to avoid 16-bit overflow VGM commands (Spec v1.50) defaults Disable oversampling by default Init fm chips Init resampler Set sound gain, a value too high will cause saturation Unload Track info TODO: convert to utf-8 Skip system 1000 / 44100 (VGM files used 44100 as timebase) make it clear that track is no longer than length Unload Clear info Reset data pointers If this was VGZ file gd3 parse info If file was trimmed add an incomplete token to the game tag Get loop If file was trimmed don't loop PSG rate Disable FM do after FM in case output buffer is changed setup buffer Post load so we can start playback oversample factor = 1.5 Emulation Remute voices Vgm_Emu_impl 0 1 2 3 4 5 6 7 8 9 A B C D E F first write is ignored, to avoid click if ( pos > this->file_end )
	{
		warning( "Stream lacked end event" );
	}  TODO: be sure there are enough bytes left in stream for particular command so we don't read past end if not looped, loop_begin == data_end warning( "Unknown stream event" );  to do: timing is working mostly by luckdebug_printf( "pairs: %d, min_pairs: %d\n", pairs, min_pairs ); Update pre-1.10 header FM rates by scanning commands Music Emu sample rate can't be changed once set Set bass frequency sample rate must be set first all or nothing TODO: what was this for?core.pcm.output( &core.blip_buf ); TODO: silence PCM if FM isn't used? channels 5-8 sample rate must be set firstdebug_printf( "blip_time_factor: %ld\n", blip_time_factor );debug_printf( "vgm_rate: %ld\n", vgm_rate ); TODO: remove? calculates vgm_rate more accurately (above differs at most by one Hz only)blip_time_factor = (long) floor( double (1L << blip_time_bits) * psg_rate / 44100 / t + 0.5 );vgm_rate = (long) floor( double (1L << blip_time_bits) * psg_rate / blip_time_factor + 0.5 ); convert filter times to samples Tell/Seek start_track() must have been called already for long skip, mute sound round to multiple of 2048 Fading Game_Music_Emu 0.5.5. http://www.slack.net/~ant/ Copyright (C) 2003-2006 Shay Green. This module is free software; you
can redistribute it and/or modify it under the terms of the GNU Lesser
General Public License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version. This
module is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
details. You should have received a copy of the GNU Lesser General Public
License along with this module; if not, write to the Free Software Foundation,
Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA  FM emulators are internally quieter to avoid 16-bit overflow VGM commands (Spec v1.50) defaults Disable oversampling by default Init fm chips Init resampler Set sound gain, a value too high will cause saturation Unload Track info TODO: convert to utf-8 Skip system 1000 / 44100 (VGM files used 44100 as timebase) make it clear that track is no longer than length Unload Clear info Reset data pointers If this was VGZ file gd3 parse info If file was trimmed add an incomplete token to the game tag Get loop If file was trimmed don't loop PSG rate Disable FM do after FM in case output buffer is changed setup buffer Post load so we can start playback oversample factor = 1.5 Emulation Remute voices Vgm_Emu_impl 0 1 2 3 4 5 6 7 8 9 A B C D E F first write is ignored, to avoid click if ( pos > this->file_end )
	{
		warning( "Stream lacked end event" );
	}  TODO: be sure there are enough bytes left in stream for particular command so we don't read past end if not looped, loop_begin == data_end warning( "Unknown stream event" );  to do: timing is working mostly by luckdebug_printf( "pairs: %d, min_pairs: %d\n", pairs, min_pairs ); Update pre-1.10 header FM rates by scanning commands Music Emu sample rate can't be changed once set Set bass frequency sample rate must be set first all or nothing TODO: what was this for?core.pcm.output( &core.blip_buf ); TODO: silence PCM if FM isn't used? channels 5-8 sample rate must be set firstdebug_printf( "blip_time_factor: %ld\n", blip_time_factor );debug_printf( "vgm_rate: %ld\n", vgm_rate ); TODO: remove? calculates vgm_rate more accurately (above differs at most by one Hz only)blip_time_factor = (long) floor( double (1L << blip_time_bits) * psg_rate / 44100 / t + 0.5 );vgm_rate = (long) floor( double (1L << blip_time_bits) * psg_rate / blip_time_factor + 0.5 ); convert filter times to samples Tell/Seek start_track() must have been called already for long skip, mute sound round to multiple of 2048 Fading Game_Music_Emu 0.5.5. http://www.slack.net/~ant/ Copyright (C) 2003-2006 Shay Green. This module is free software; you
can redistribute it and/or modify it under the terms of the GNU Lesser
General Public License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version. This
module is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
details. You should have received a copy of the GNU Lesser General Public
License along with this module; if not, write to the Free Software Foundation,
Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA  FM emulators are internally quieter to avoid 16-bit overflow VGM commands (Spec v1.50) defaults Disable oversampling by default Init fm chips Init resampler Set sound gain, a value too high will cause saturation Unload Track info TODO: convert to utf-8 Skip system 1000 / 44100 (VGM files used 44100 as timebase) make it clear that track is no longer than length Unload Clear info Reset data pointers If this was VGZ file gd3 parse info If file was trimmed add an incomplete token to the game tag Get loop If file was trimmed don't loop PSG rate Disable FM do after FM in case output buffer is changed setup buffer Post load so we can start playback oversample factor = 1.5 Emulation Remute voices Vgm_Emu_impl 0 1 2 3 4 5 6 7 8 9 A B C D E F first write is ignored, to avoid click if ( pos > this->file_end )
	{
		warning( "Stream lacked end event" );
	}  TODO: be sure there are enough bytes left in stream for particular command so we don't read past end if not looped, loop_begin == data_end warning( "Unknown stream event" );  to do: timing is working mostly by luckdebug_printf( "pairs: %d, min_pairs: %d\n", pairs, min_pairs ); Update pre-1.10 header FM rates by scanning commands Music Emu sample rate can't be changed once set Set bass frequency sample rate must be set first all or nothing TODO: what was this for?core.pcm.output( &core.blip_buf ); TODO: silence PCM if FM isn't used? channels 5-8 sample rate must be set firstdebug_printf( "blip_time_factor: %ld\n", blip_time_factor );debug_printf( "vgm_rate: %ld\n", vgm_rate ); TODO: remove? calculates vgm_rate more accurately (above differs at most by one Hz only)blip_time_factor = (long) floor( double (1L << blip_time_bits) * psg_rate / 44100 / t + 0.5 );vgm_rate = (long) floor( double (1L << blip_time_bits) * psg_rate / blip_time_factor + 0.5 ); convert filter times to samples Tell/Seek start_track() must have been called already for long skip, mute sound round to multiple of 2048 Fading